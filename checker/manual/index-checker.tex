%\htmlhr
\chapter{Index Checker for array bounds\label{index-checker}}

The Index Checker warns about unsafe array accesses.  It protects
against Java's ArrayIndexOutOfBoundsException. A class checked by the
Index Checker  will not throw an ArrayIndexOutOfBoundException unless the
index has overflowed or underflowed.

The Index Checker maintains an estimate of the range of values for each array
index expression.  There are two ways an expression can fail to be safe for use as an
array index: either it can be too low or it can be too high. The Index
Checker will warn about both types of dangerous accesses, and will
issue different warnings for the two.

Typically, programmers do not need to write annotations to use the
Index Checker. The Index Checker will infer properties of indexes from
the code around them.  For example, it will infer that \<x> is positive
within the then block of an \code{if (x > 0)} statement.

Internally, the Index Checker is composed of two checkers: the Lower
Bound Checker, which checks whether potential accesses may be too low,
and the Upper Bound Checker, which checks whether potential accesses
may be too high. The two checkers and their type hierarchies are
detailed in the remainder of this section.

\section{Running the Index Checker\label{index-running}}

To run the Index Checker, run the command

\begin{alltt}
javac -processor index \emph{MyJavaFile}.java
\end{alltt}


\section{The Lower Bound Checker\label{index-lowerbound}}

The Lower Bound Checker looks for accesses into arrays that might be
too low.  It warns its users about any such possible accesses. The
Lower Bound Checker's type system uses the following qualifiers.
The Lower Bound Checker infers all of these qualifiers automatically (the
rules appear in file \<lowerbound\_rules.txt> in the implementation),
so the programmer rarely has to write them.

\begin{description}
\item[\refqualclass{checker/lowerbound/qual}{Positive}]
  The value is 1 or greater, so it is not too low to be used as an array index.
\item[\refqualclass{checker/lowerbound/qual}{NonNegative}]
  The value is 0 or greater, so it is not too low to be used as an array index.
\item[\refqualclass{checker/lowerbound/qual}{GreaterThanOrEqualToNegativeOne}]
  The value is -1 or greater.
  It may not be used as array indices, because it might be too low.
\item[\refqualclass{checker/lowerbound/qual}{LowerBoundUnknown}]
  There is no information about the value.
  It may not be used as an array index, because it might be too low.
  This type is the top type.
\end{description}

\begin{figure}
\includeimage{lowerbound}{7cm}
\caption{The type hierarchy used by the Lower Bound Checker.}
\label{fig-lowerbound-types}
\end{figure}


\section{The Upper Bound Checker\label{index-upperbound}}

The Upper Bound Checker warns about array accesses whose index might be
too high. The Upper Bound Checker uses the following
qualifiers:

\begin{description}
\item[\refqualclasswithparams{checker/upperbound/qual}{LessThanLength}{String[] names}]
  A variable with this type
  has value less than the length of each array listed in names.
\item[\refqualclasswithparams{checker/upperbound/qual}{EqualToLength}{String[] names}]
  A variable with this type
  has value equal to the length of each array listed in names.
\item[\refqualclasswithparams{checker/upperbound/qual}{LessThanOrEqualToLength}{String[] names}]
  A variable with this type
  has value less than or equal to the length of each array listed in names.
\item[\refqualclass{checker/upperbound/qual}{UpperBoundUnknown}]
  There is no information about the value of this variable.
  This type is the top type.
\end{description}
