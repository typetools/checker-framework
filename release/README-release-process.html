<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
  <title>Checker Framework release process</title>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet"/>
  <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <style type="text/css">
    .page-header {
    padding-left: 10px;
    margin-left: 10px;
    }

    .container {
    padding-left: 10px;
    margin-left: 10px;
    }

    .file_layout_table th {
    background: #EFEFEF;
    }

    ul.step_list li {
    margin-top: 10px;
    }

    ul#backing_out_steps li {
    padding-bottom: 10px;
    }
  </style>
</head>

<body>
<div class="page-header">
  <h1>Release Process: <small>JSR 308 compiler, Annotation File Utilities, Checker Framework</small></h1> <!-- omit from toc -->
</div>

<div class="container">
<div class="row" style="width: 100%">
<div id="content">
<p>
  This document explains how to make a release of the Checker Framework, the Type Annotations Compiler,
  and the Annotation File Utilities.
The process takes around 3 hours (including manual steps) when all goes according to plan.
  However, the lengthiest steps are automatic so you will be able to work on other tasks.
</p>

<div class="alert alert-success">
  <strong>Note:</strong> If you have never read this document before, please read
  the section <a href="#pre_release_checklist">Pre-release Checklist</a> first.
  It is also recommended that you read sections  <a href="#release_process_overview">Release Process Overview</a>
  and <a href="#changelog_guide">Changelog Guidelines</a> to familiarize yourself
  with the process.
</div>

<p>Contents:</p>
<!-- start toc.  do not edit; run html-update-toc instead -->
    <ul>
      <li><a href="#release_process">Release process</a>
        <ul>
          <li><a href="#checklist">Checklist of steps a release person must follow</a></li>
          <li><a href="#notes-for-release-person">Recommendations/notes for the release person</a></li>
          <li><a href="#phases">Milestone Phases</a></li>
          <li><a href="#phases-description">Description of the phases and deadlines</a></li>
          <li><a href="#deadline-enforcement">Deadline enforcement</a></li>
        </ul></li>
      <li><a href="#step_by_step">Step by Step</a></li>
      <li><a href="#continuous-integration">Continuous integration (nightly) tests</a></li>
      <li><a href="#pre_release_checklist">Pre-release Checklist</a></li>
      <li><a href="#release_process_overview">Release Process Overview</a>
        <ul>
          <li><a href="#file_layout">File Layout</a></li>
          <li><a href="#release_scripts">Release Scripts</a></li>
        </ul></li>
      <li><a href="#changelog_guide">Changelog Guidelines</a>
        <ul>
          <li><a href="#content_guidelines">Content Guidelines</a></li>
          <li><a href="#style_guidelines">Style Guidelines</a></li>
        </ul></li>
      <li><a href="#backing_out">Backing Out an Uncommitted Release</a>
        <ul>
          <li><a href="#backing_out_steps">Manual Steps to Back Out a Release</a></li>
        </ul></li>
      <li><a href="#future_improvements">Future Improvements</a></li>
    </ul>
<!-- end toc -->


<h2 id="release_process">Release process</h2>

<h3 id="checklist">Checklist of steps a release person must follow</h3>

    <ol>
      <li>Once ever:
        <ul>
          <li>Follow the steps in the <a href="#pre_release_checklist">Pre-release Checklist</a>
           in the Release Process document. Some of these steps can take days to complete as they
            involve obtaining permissions.</li>
        </ul>
      </li>
       <li>First day of the development milestone:
         <ul>
           <li>Plan the feature freeze, code freeze and release dates for the following two months.  The release date should be the first business day of the month.  (Avoid releasing
             near the end of a month instead of the beginning of the next month, as that makes it easier for users
             to keep track of the cadence of our releases.  For example, having a June 1st and a June 30th release makes
             it harder to tell that the June 30th release is meant for distribution in the month of July.)
           </li>
           <li>
           Send an e-mail to the
             checker-framework-dev, annotation-tools-dev and jsr308-langtools-dev mailing lists with these dates.
           <!--
             Also please make sure to add these dates to the "Checker Framework Developers" Google Calendar.
           -->
             </li>
         </ul>
       </li>
       <li>One week before Feature Freeze:
         <ul>
          <li>Remind bug owners of their bugs outstanding.</li>
         </ul>
       </li>
       <li>Two business days before Feature Freeze:
         <ul>
          <li>E-mail checker-framework-dev, annotation-tools-dev and jsr308-langtools-dev reminding
          users of the upcoming Feature Freeze and the requirements for this deadline, including
          the requirement for changelogs to be complete.</li>
         </ul>
       </li>
       <li>The work morning after Feature Freeze:
         <ul>
           <li>Ensure that all the <a href="#continuous-integration">continuous integration jobs</a> are passing.</li>
           <li>Ensure that
           the changelogs and documentation for the Checker Framework, Type Annotations Compiler and AFU are complete by following
           <a href="#step_by_step">these instructions</a> up to and including the &quot;Review the changelogs and documentation&quot; step.
           <li>E-mail Mike asking him to vet the changelogs
           that are checked in.</li>
           <li>E-mail checker-framework-dev, annotation-tools-dev and jsr308-langtools-dev reminding
           users of the upcoming Code Freeze and the requirements for this deadline.</li>
         </ul>
       </li>
       <li>The work morning after Code Freeze:
         <ul>
           <li>Ensure that all the <a
           href="#continuous-integration">continuous
           integration jobs</a> are passing.</li>
           <li>If the above items are taken care of, perform the release.</li>
         </ul>
       </li>

    </ol>

<!--
    <h3 id="notes-for-release-person">Recommendations/notes for the release person</h3>
    <ul>
      <li>As the release person, consider pushing your bug fixes at least two days prior to the code freeze deadline &mdash; this is because you
      are likely to be helping other people make their Jenkins projects become green during those two days.</li>
      <li>The reason Mike must be asked to look at the changelogs right after feature freeze (instead of
      code freeze) is that there no longer is a "recall class" bug fix period, so there is now only one
      working day between feature freeze and the release.
      This ensures that there are no delays in releasing the products (due to
      incomplete changelogs) or in sending the announcement e-mail.
      If during the bug fixing period anyone fixes a bug that is worth mentioning as more
      than a number, the changelog can be amended accordingly and Mike can be warned about it.</li>
    </ul>
-->

    <h3 id="phases">Milestone Phases</h3>
    <!-- I'm not sure how to get the exact effect achieved by this HTML 4 code: -->
    <!--    <table border="1" width="864" cellspacing="2" cellpadding="2"> -->
    <table style="border:1px solid black;width:864px;border-collapse:separate;border-spacing:2px;paddng:2px;">
      <tbody>
        <tr>
          <td>
            <p style="background-color: #6d9de9">Development</p>
          </td>
          <td>
            <p style="background-color: #92c27d">Bug fixing</p>
          </td>
          <td>
            <p style="background-color: #d0e0e3">Release</p>
          </td>
        </tr>
        <tr>
          <td>
            <p>(Varies, typically 3 to 4 weeks)</p>
          </td>
          <td>
            <p>1 business day</p>
          </td>
          <td>
            <p>1 business day</p>
          </td>
        </tr>
      </tbody>
    </table>
    <table style="width:864px;">
      <tbody>
        <tr>
          <td>
            <p>Deadlines:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
          </td>
          <td>
            <p style="color:blue">Feature freeze</p>
          </td>
          <td>
            <p style="color:#6aa74f">Code freeze</p>
          </td>
          <td style="float:right;">
            <p style="color:#999999">Release</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div>
    <p>Example timeline:</p>
    <img src="example-release-schedule.png" alt="Example release schedule" />
    <h3 id="phases-description">Description of the phases and deadlines</h3>
    <p style="background-color: #6d9de9">Development</p>
    <p>During the development phase, arbitrarily large or complex changes may be pushed.</p>
    <p style="background-color:blue">Feature freeze</p>
    <p>By the <em>feature freeze </em>deadline, all new feature code, associated tests, and documentation
    must be pushed. If a feature is not complete by this time, then it should be delayed until the next
    release. By this time, all users should update the relevant project&rsquo;s changelog to include
    features and bug fixes they have made during this development cycle (not including bug fixes made
    in the day that follows).</p>
    <p style="background-color: #92c27d">Bug fixing</p>
    <p>During this phase bugs are fixed, including minor bugs that may have been discovered
    (by the new tests or otherwise) in the feature implementation or documentation. You are allowed
    to fix any bug that you want, add new tests and documentation, etc., during this time. But no
    new features may be implemented. Example bugs that would be fixed during this phase are bugs
    revealed by Jenkins that were not revealed by the test suites that were run before pushing a feature.</p>
    <p style="color:#6aa74f">Code freeze</p>
    <p>By <em>code freeze</em>, the code is assumed to be in a shippable state. Pushes to the
    repository are no longer allowed.</p>
    <p style="background-color: #d0e0e3">Release</p>
    <p>The person responsible for making the release runs the release scripts and other manual tasks
    for the release (note that any pushes during this phase force the automated tests to restart and
    are likely to delay the release).</p>
    <h3 id="deadline-enforcement">Deadline enforcement</h3>
    <p>The following are only enforced for the 'master' branch from which the release is performed:</p>
    <ul>
      <li>Any large or complex change (i.e. a feature change or a design change) pushed after
      feature freeze will be reverted.</li>
      <li>Any fix for a bug pushed after code freeze for which an exception was not made will be reverted.</li>
      <li>If a critical bug is discovered late and its fix is not checked in with enough time
      for Jenkins tests to complete before Release Day, <strong>then the release is delayed</strong>.</li>
    </ul>

<h2 id="step_by_step">Step by Step</h2>

<p>
  More information about the steps is
  provided in the code comments of the <code>main()</code> functions of the <code>release_build</code>
  and <code>release_push</code> scripts. Please read those comments if you have never done so before.
</p>

<p>
Answering 'no' to a prompt does not exit the script unless otherwise indicated.
</p>

<p>
Be sure to carefully read all instructions on the command-line before answering 'yes' to a prompt.
This is because the scripts do not ask you to say 'yes' after each step, so you may
miss a step if you only read the paragraph asking you to say 'yes'.
</p>

<ol>
  <li>If you have never made a release before, follow the instructions in the
  <a href="#pre_release_checklist">Pre-release Checklist</a>.
  </li>
  <li>Download and install the lastest version of Eclipse.  Check that the Eclipse version
      matches the version listed in
      <a href="../eclipse/checker-framework-eclipse-update-site/manual/index.html#installation">the Eclipse plugin manual</a>.
  </li>
  <li>
      <strong>Log into Buffalo</strong><br/>
      <code>ssh $USER@buffalo.cs.washington.edu<br/></code>
  </li>
  <li>
      <strong>In a user-specific temporary directory, clone/update the Checker Framework repository (it contains the release scripts).</strong><br/>
      <code>mkdir -p /scratch/$USER/jsr308-release<br/></code>
      <code>cd /scratch/$USER/jsr308-release<br/></code>
      <code>(cd checker-framework && git pull --quiet) || git clone --quiet https://github.com/typetools/checker-framework.git<br/></code>
      <code>cd checker-framework/release<br/></code>
  </li>
  <li><strong>Review the changelogs and documentation</strong><br/>
      Ensure that the changelogs and documentation for the Checker Framework, Type Annotations Compiler and
      AFU are complete.  First follow the instructions at <a href="#content_guidelines">content guidelines</a>.  Then,
      run release_build in a mode that reviews the documentation only:
      <code>cd /scratch/$USER/jsr308-release/checker-framework/release<br/></code>
      <code>python release_build.py all --review-manual</code><br/><br/>
      <strong>Note:</strong> This step can be performed in advance of the release day. It is recommended
      that this be done the work morning after Feature Freeze.
  </li>
  <li><strong>Run release_build</strong> to create the release artifacts and place them in the development website<br/>
      <code>python release_build.py all --auto</code><br/><br/>
      For verbose debugging output, use the <code>--debug</code> option.<br/><br/>
      <strong>Note:</strong> The &quot;all&quot; argument specifies that all projects should be built.
      There has been some work done in order to select only specific projects (JSR 308 compiler, AFU, Checker Framework)
      to be built but more work still needs to be done.  Just pass &quot;all&quot; for now.
      See also <a href="#fi_buffalo_integeration">Buffalo Integration</a> for more information
      on the option &quot;--auto&quot;, which you can omit in order to
      be asked more questions during the build.
  </li>
  <li>
      <strong>Run release_push</strong> to move release artifacts from the development website to the live site and to Maven Central <br/>
      <code>python release_push.py release</code><br/><br/>
      For minimal prompting, use the <code>--auto</code> option.<br/><br/>
      <div class="alert alert-danger">
        <strong>Note:</strong> The &quot;<strong>release</strong>&quot; argument states that you intend
        to do an actual release.  If you just want to test the script, leave out &quot;release&quot;
        and the script will run but not update anything.
      </div>

      If you get an obscure error about permissions, try running the release_push script several times
      in a row. This will sometimes update the repository permissions such that the script can proceed
      further each time.
  </li>
</ol>

  <h2 id="continuous-integration">Continuous integration (nightly) tests</h2>

  <p>
    The following continuous integration tests should all pass before you make changes that you need to test.  If not, notify the
    relevant team members.
  </p>

<ol>
  <li id="travis">The following Travis builds should be passing (refresh this page to see the latest status):
  <ul>
    <li>Annotation File Utilities: <img src="https://travis-ci.org/typetools/annotation-tools.svg?branch=master" alt="Travis typetools/annotation-tools status"/></li>
    <li>Checker Framework: <img src="https://travis-ci.org/typetools/checker-framework.svg?branch=master" alt="Travis typetools/checker-framework status"/></li>
    <li>checker-framework.demos: <img src="https://travis-ci.org/typetools/checker-framework.demos.svg?branch=master" alt="Travis typetools/checker-framework.demos status"/></li>
    <li>checker-framework-inference: <img src="https://travis-ci.org/typetools/checker-framework-inference.svg?branch=master" alt="Travis typetools/checker-framework-inference status"/></li>
    <li>Daikon: <img src="https://travis-ci.org/codespecs/daikon.svg?branch=master" alt="Travis codespecs/daikon status"/></li>
    <li>daikon-typecheck: <img src="https://travis-ci.org/typetests/daikon-typecheck.svg?branch=master" alt="Travis typetests/daikon-typecheck status"/></li>
    <li>guava-typecheck: <img src="https://travis-ci.org/typetests/guava-typecheck.svg?branch=master" alt="Travis typetests/guava-typecheck status"/></li>
    <li>plume-lib: <img src="https://travis-ci.org/mernst/plume-lib.svg?branch=master" alt="Travis mernst/plume-lib status"/></li>
    <li>plume-lib-typecheck: <img src="https://travis-ci.org/typetests/plume-lib-typecheck.svg?branch=master" alt="Travis typetests/plume-lib-typecheck status"/></li>
    <li>plume-lib-check-index-new: <img src="https://travis-ci.org/mernst/plume-lib-check-index-new.svg?branch=master" alt="Travis mernst/plume-lib-check-index-new status"/></li>
    <li>Sparta: <img src="https://travis-ci.org/typetools/sparta.svg?branch=master" alt="Travis typetools/sparta status"/></li>
  </ul>
  </li>
  <li> Check that <a href="https://travis-ci.org/typetests/daikon-typecheck/builds">a daikon-typecheck Travis job</a> was triggered by the last commit of the Checker Framework before the code freeze.
  </li>
</ol>

  <h2 id="pre_release_checklist">Pre-release Checklist</h2>
  <p>If you have not performed a release before you must follow these steps.</p>
  <table class="table">
    <tr>
      <td>1.</td>
      <td><strong>Ensure you are a member of the types_www and pl_gang groups</strong><br/>
        Run the command "groups" on the file system (perhaps on Buffalo).
        If the group types_www or pl_gang do not appear in the list, email the appropriate
        person to be added (currently Michael Ernst and Werner Dietl for types_www and
        Michael Ernst for pl_gang).
      </td>
    </tr>
    <tr>
      <td>2.</td>
      <td><strong>Import the Checker Framework signing key for PGP</strong><br/>
        SSH into Buffalo and run the following command:<br/>
        <code>gpg --allow-secret-key-import --import /projects/swlab1/checker-framework/hosting-info/release-private.key<br/><br/></code>
        Note:  The password for this key is located in the file<br/>
        <code>/projects/swlab1/checker-framework/hosting-info/release-private.password<br/></code>
        and is used by the release_push script to sign Maven artifacts.<br/>
      </td>
    <tr>
      <td>3.</td>
      <td><strong>Sign up for a Sonatypes Account</strong><br/>
        You will likely want to do this a few days in advance.
        Directions can be found <a href="http://central.sonatype.org/pages/ossrh-guide.html">here</a>.
        Remember to be asked to be added to the org.checkerframework repository by creating
        a ticket (see the note
        <a href="http://central.sonatype.org/pages/ossrh-guide.html#create-a-ticket-with-sonatype">here</a>).
        If after signing up for a Sonatype JIRA account you are not able to sign in to
        <a href="https://issues.sonatype.org">https://issues.sonatype.org</a>
        to create a ticket, there may be a configuration problem with your account. In that case, sign up for a
        second Sonatype account, and use that account to file a ticket indicating that you cannot sign in
        with your first account.
      </td>
    </tr>
    <tr>
      <td>4.</td>
      <td><strong>Add your account information to settings.xml in your home directory.</strong><br/>
        Create a <code>~/.m2/settings.xml</code> file with the contents specified in
        <code>/projects/swlab1/checker-framework/hosting-info/release-settings.txt</code>
        using the information you just created for your Sonatypes Account on Buffalo or other
        network host.  Since the file contains your password, make it non-readable:  <code>chmod og-rw ~/.m2/settings.xml</code>
      </td>
    </tr>
    <tr>
      <td>5.</td>
      <td><strong>Copy login related settings from your .hgrc file to a .hgrc in your home directory
          in Buffalo.</strong><br/>
        On your local machine, you probably have an .hgrc file in your home directory
        with login information for Mercurial. Copy the login related parts of this file to
        your home directory on Buffalo. Copying the entire file may lead to path issues.<br/>
      </td>
    </tr>
    <tr>
      <td>6.</td>
      <td><strong>Complete the Eclipse plugin pre-build checklist</strong><br/>
          Follow the instructions <a href="../eclipse/README-developers.html#pre_build_checklist">here</a>.
      </td>
    </tr>
    <tr>
      <td>7.</td>
      <td><strong>Get edit privileges for Checker Framework, JSR 308 compiler, Annotation Tools</strong><br/>
        Once a release has been completed, you will be prompted to update issues in the
        issue tracker for each project that has been released.
        You will need to be a "developer" for each project so that you have update privileges for
        the issue trackers.
        You should be listed as a member of typetools on <a href="https://bitbucket.org/typetools/profile/members">Bitbucket</a> and a committer on <a href="https://github.com/orgs/typetools/teams/committers">GitHub</a>.
        You should be listed as a member of typetests on <a href="https://bitbucket.org/typetests/profile/members">Bitbucket</a> and a committer on <a href="https://github.com/orgs/typetests/teams/committers">GitHub</a>.
      </td>
    </tr>
    <tr>
      <td>8.</td>
      <td><strong>Ensure that you can see the status of all Travis relevant to the release</strong><br/>
        Ensure that the status of all the Travis projects listed <a href="#continuous-integration">here</a> is displayed correctly.
      </td>
    </tr>
    <tr>
      <td>9.</td>
      <td><strong>Read the Checker Framework Development Process document</strong><br/>
        A release person has responsibilities each month in addition to performing the release.
        The <a href="README-release-process.html">Checker Framework Release Process document</a>
        explains these responsibilities in detail.  Please re-read the <a href="README-release-process.html#checklist">checklist</a> in this document at the beginning
        of each month that you are the designated the release person, and help keep this document up
        to date with the latest best practices.
      </td>
    </tr>
    <tr>
      <td>10.</td>
      <td><strong>Install html5validator</strong>
       If you are going to perform the release on buffalo, you may need to install
       html5validator.  If <code>html5validator --version</code> issues any errors, try running
       <code>pip install --user html5validator</code>.
      </td>
    </tr>
    <tr>
      <td>11.</td>
      <td><strong>Run release_build once</strong><br/>
        To save time on release day addressing potential configuration issues, before your first
        release day, ensure that <code>release_build</code> is working correctly
        by following steps 2, 3 and 5 of the <a href="#step_by_step">Step by Step</a> section.
        <code>release_build</code> still needs to be re-run on release day (even if no changes
        were pushed to any repositories since the last run of <code>release_build</code>) in
        order for the release date to be correct in all documents.
      </td>
    </tr>
  </table>

  <h2 id="release_process_overview">Release Process Overview</h2>
  <p>This section first explains the structure of the projects on disk on Buffalo, then lists scripts used during the release process.</p>

    <h3 id="file_layout">File Layout</h3>
    <table class="table table-bordered file_layout_table">
      <tr><th colspan="2">Release Directory <span class="glyphicon glyphicon-folder-open" style="float:right;"></span></th></tr>
      <tr>
        <td colspan="2" class="top_file">/scratch/$USER/jsr308-release</td>
        <td>Contains repositories and scripts to perform a release</td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">build</td>
        <td>Contains repositories for:
          annotation-tools, checker-framework, jsr308-langtools, plume-bib, plume-lib, stubparser<br/>
          These repositories are used to build the Checker Framework and its dependencies.
        </td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">interm</td>
        <td>Contains repositories for:
          annotation-tools, checker-framework, jsr308-langtools, plume-bib, plume-lib, stubparser<br/>
          The repositories in build are clones of repositories in interm.  The repositories
          in interm are clones of the GitHub/Bitbucket repositories.  This is so that
          we can test and push the release to the interm repositories then check the
          release before we have made any irreversible changes.  Then, when the release
          is validated, all we do is run &quot;git push&quot; or &quot;hg push&quot; on all of the repos in interm.
        </td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">sanity</td>
        <td>Directory used by the release_push script to do sanity checks.
        </td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">checker-framework/release</td>
        <td>The directory where the release scripts are run from.  Any changes made under this directory
          won't be automatically committed when the release is committed.
        </td>
      </tr>

    </table>
    <table class="table table-bordered file_layout_table">
      <tr><th colspan="2">Jenkins Tools Directory <span class="glyphicon glyphicon-folder-open" style="float:right;"></span></th></tr>

      <tr>
        <td colspan="2" class="top_file">/scratch/secs-jenkins</td>
        <td>Contains files used to run Jenkins including versions of Java.</td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">java</td>
        <td>Contains the versions of Java used to build the release.</td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">tools</td>
        <td>Contains the Hevea library and some TEXINPUTS for the release.</td>
      </tr>

    </table>
    <table class="table table-bordered file_layout_table">
      <tr><th colspan="2">Live Website Directory <span class="glyphicon glyphicon-folder-open" style="float:right;"></span></th></tr>

      <tr>
        <td colspan="2" class="top_file">/cse/www2/types</td>
        <td>The file system location of the website: <br/><a href="https://checkerframework.org/">https://checkerframework.org/</a>.</td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">m2-repo</td>
        <td>The location of the in-house Maven repository.  It is accessed through URL: <br/>
          <a href="https://checkerframework.org/m2-repo">https://checkerframework.org/m2-repo</a>
        </td>
      </tr>

    </table>
    <table class="table table-bordered file_layout_table">
      <tr><th colspan="2">Staging (Development) Website Directory <span class="glyphicon glyphicon-folder-open" style="float:right;"></span></th></tr>

      <tr>
        <td colspan="2" class="top_file">/cse/www2/types/dev</td>
        <td>The file system location of the development staging website: <br/><a href="https://checkerframework.org/dev/">https://checkerframework.org/dev</a>.</td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">&lt;project&gt;/current</td>
        <td>The staging analogue to /cse/www2/types/&lt;project&gt;/current directory.  The latest release is copied from this directory
          to the /cse/www2/types/&lt;project&gt;/current by the release_push script after a prompt.
        </td>
      </tr>
      <tr>
        <td></td>
        <td colspan="2">m2-repo</td>
        <td>The location of the in-house staging version of the Maven repository.  It is accessed through URL: <br/>
          <a href="https://checkerframework.org/dev/m2-repo">https://checkerframework.org/dev/m2-repo</a>
        </td>
      </tr>
    </table>

    <h3 id="release_scripts">Release Scripts</h3>
    <p>As mentioned above, in order to release the Checker Framework you must run two scripts,
      release_build.py and release_push.py but there are supportings scripts and files in the
      release directory.  Some of these files are described below.
    </p>

    <table class="table table-bordered">
      <tr>
        <td>release_build.py</td>
        <td>Reverts the build/interm repositories to the state of their master repositories in GitHub/Bitbucket.
          It then builds the projects and all their artifacts and then stages a development
          version of all websites to
          <a href="https://checkerframework.org/dev/">https://checkerframework.org/dev/</a>
          This script is thoroughly documented in code comments located in its <code>main()</code> function.
        </td>
      </tr>
      <tr>
        <td>release_push.py</td>
        <td>Verifies the release at
          <a href="https://checkerframework.org/dev/">https://checkerframework.org/dev/</a>
          is correct through scripts and manual steps.  When the user is satisfied the website
          is correct it deploys the website to the live website:
          <a href="https://checkerframework.org/">https://checkerframework.org/</a>.
          It also pushes Maven artifacts to our checker-framework.com repo and Maven central.
          Furthermore, there are a number of prompts to manually build the Eclipse plugin and
          test various components.
          This script is thoroughly documented in code comments located in its <code>main()</code> function.
        </td>
      </tr>
      <tr>
        <td>release_utils.py</td>
        <td>Utility methods used in both release_push and release_build.</td>
      </tr>
      <tr>
        <td>sanity_checks.py</td>
        <td>Contains methods to run various sanity checks.  These methods are called from release_push.py
        </td>
      </tr>
      <tr>
        <td>release_vars.py</td>
        <td>Global variables used in release_push, release_build, and sanity_checks.  These should NOT
          be used in release_utils as release_utils is supposed to consist of self-contained
          reusable methods.  These variables are tailored for running the scripts on
          buffalo.cs.washington.edu
        </td>
      </tr>
      <tr>
        <td>release.xml</td>
        <td>The previous release script used Ant to do a number of tasks.  Rather than
          reinvent the wheel, we still use the targets from this script.
          They are called from release_push and release_build.
        </td>
      </tr>
    </table>

  <h2 id="changelog_guide">Changelog Guidelines</h2>
  <p> Each developer is responsible for updating project changelogs to reflect changes they
    have made each month.  The changelogs should be updated by "feature freeze" though at the
    latest this should be done before "code freeze".  Before releasing, the person performing
    the release will be asked to verify the changelogs.  Please check that
    there aren't typos (i.e. missing release date/version information, spelling errors, etc...).
    Also check that the changelog obeys the guidelines below.
  </p>

    <h3 id="content_guidelines">Content Guidelines</h3>
    <ul>
      <li>Only (and all) changes that affect users go into the changelog.
        If a change is breaking, no matter how small, mention it.</li>
      <li>List all issues (in issue trackers) resolved since the previous release, for
          the Checker Framework (<a href="https://checkerframework.org/changelog.txt">previous release</a>,
          <a href="https://github.com/typetools/checker-framework/issues?q=is%3Aissue+is%3Aclosed+sort%3Aupdated-desc">issues query</a>,
          <a href="https://github.com/typetools/checker-framework/blob/master/changelog.txt">current changelog</a>),
          Annotation File Utilities (<a href="https://checkerframework.org/annotation-file-utilities/changelog.html">previous release</a>,
          <a href="https://github.com/typetools/annotation-tools/issues?q=is%3Aissue+is%3Aclosed+sort%3Aupdated-desc">issues query</a>,
           <a href="https://github.com/typetools/annotation-tools/blob/master/annotation-file-utilities/changelog.html">current changelog</a>),
          and jsr308-langtools (<a href="https://checkerframework.org/jsr308/changelog-jsr308.txt">previous release</a>,
          <a href="https://bitbucket.org/typetools/jsr308-langtools/issues?status=resolved&sort=-updated_on">issues query</a>,
           <a href="https://bitbucket.org/typetools/jsr308-langtools/src/default/doc/changelog-jsr308.txt?at=default&fileviewer=file-view-default">current changelog</a>).
      </li>
          <li>
            Examine the version control logs since the last release tag to ensure they are reflected in the changelogs when appropriate.
        This can be done from the command-line with:<br/>
            <code>cd $CHECKERFRAMEWORK && git log --name-status `git describe --abbrev=0 --tags`..</code><br/>
            <code>cd $CHECKERFRAMEWORK/../annotation-tools && git log --name-status `git describe --abbrev=0 --tags`..</code><br/>
            <code>cd $CHECKERFRAMEWORK/../jsr308-langtools && hg log -r `hg log -r "." --template "{latesttag}\n"`:</code><br/>
        or by opening the following commit queries for <a href="https://bitbucket.org/typetools/jsr308-langtools/commits/all">jsr308-langtools</a>,
        the <a href="https://github.com/typetools/annotation-tools/commits/master">Annotation File Utilities</a> and the
            <a href="https://github.com/typetools/checker-framework/commits/master">Checker Framework</a>.
      </li>
          <li>
            Even if some code has been committed to the repository, don't
            announce the feature until it has been documented in the manual.
      </li>
    </ul>
    <h3 id="style_guidelines">Style Guidelines</h3>
    <ul>
      <li>Changes are written from the user's perspective.  Don't include implementation details that users
        don't care about.
      </li>
      <li>To be consistent, write in the past tense (e.g. &quot;Added option for verbose error messages&quot;).</li>
      <li>Lines should not exceed 80 characters wide.</li>
      <li>Break the different programs into their own sections.  See notes on release 1.7.0 and 1.5.0 for an
        example.  Tools like the Eclipse plugin should have their own section within the
        Checker Framework release notes (excluding issue fixes from the issue tracker).
      </li>
      <li>Be specific.  Don't write something like "added a few options to Eclipse plugin".  Do write "added
        options to the Eclipse plugin to include stub files, ignore warnings, and show verbose output."
      </li>
    </ul>

  <h2 id="backing_out">Backing Out an Uncommitted Release</h2>
  <p>At the time of this writing, there are 2 steps that cannot be reverted.</p>
  <ol>
    <li>The push from the interm repositories to the GitHub/Bitbucket (release) repositories</li>
    <li>The release of the staged Maven artifacts</li>
  </ol>
  <p> If you have executed either of these steps and then realized there is a breaking error, you should do another
    release.  The release script will allow you to do a point release like &quot;1.8.0.1&quot; when a version
    &quot;1.8.0&quot; already exists.<br/>
    <br/>
    If you have NOT committed an irreversible step then you can
    follow the steps below to point the live release to a previous release.  You can then redo the original
    release.  Make sure to say &quot;yes&quot; when the release script asks you to delete the old directories.
  </p>
  <h3 id="backing_out_steps">Manual Steps to Back Out a Release</h3>
  <ul>
    <li><strong>Drop the artifacts from Central</strong><br/>
      You may have staged and then closed the artifacts in the Sonatypes Central repository.  Drop (do NOT release)
      these artifacts.  See
      <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-DroppingaStagingRepository%28i.e.WhattoDoifYourStagingRepositoryHasErrors%29">
        the Sonatypes OSS Repository Usage Guidelines.
      </a>
    </li>
    <!-- <li><strong>Drop the Maven Artifacts from our Maven repo *** currently unneeded ***</strong>
      <p class="alert alert-warning"><strong>Note:</strong> The procedure below is NOT recommended
        by the Maven developers guide.  However, if done carefully and quickly no harm will likely
        come.  If people end up with out-of-date artifacts, recommend to them that they use the -U option
        in Maven 3.  Never follow these instructions if the plugin release has been publicized or
        existed for a while.
      </p>

      At the moment, we have decided to drop the user of our local Maven repository in favor of using
      the Central repository exclusively.  This may not be the case in the future.  If we do have a
      local repository, you need to go into the repositories directory (usually an m2-repo directory) and
      manually delete the versions of the Maven artifacts.  For instance, for the artifacts checker and compiler
      using version 0.9.8, I would delete the directories:
      <ul>
        <li>.../m2-repo/org/checkerframework/checker/0.9.8</li>
        <li>.../m2-repo/org/checkerframework/compiler/0.9.8</li>
      </ul>
      Furthermore, I would grep the files in the parents of these directories and ensure the version number
      does not appear in any metadata.  If so, fix up the metadata.
    </li> -->
  </ul>

  <p class="alert alert-danger"><strong>Note:</strong> You may find yourself copying release directories for some
    reason or other.  It is important to remember that the symlinks may be absolute.  You should check any
    symlinks that may be affected by the move and ensure they point to the new location and not the old one.
  </p>

  <h2 id="future_improvements">Future Improvements</h2>
  <p>Below is a roughly priority-ordered list of future improvements.  In a perfect world we would do
    all of these.  At the moment, I believe only the first 2 (Open JDK Javadoc Fixes,
    and More Sanity Checks) should have any appreciable priority.
  </p>

    <h3 id="fi_jdk-api_fixup">Open JDK/JSR308 Javadoc</h3> <!-- omit from toc -->
    Generating the Javadocs for the entire JDK is not simple.  We have previously generated these but have
    not updated them in a while.  They can be found here:<br/>
    <a href="https://checkerframework.org/jdk-api/">https://checkerframework.org/jdk-api/</a><br/>
    When we generate javadoc for the Type Annotations Compiler and Checker Framework we link against these docs.
    But because they were generated in a faulty manner in the first place, there are many broken links related to
    package summaries of the jdk-api docs.  It is highly unlikely that users will ever run into these links, since
    they occur in pages like Swing's package summary, but nonetheless it would be good to build these docs
    in the proper manner with no broken links.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Figure out the best way to build the Open JDK Javadoc.</li>
      <li>Add a release script step to build the Open JDK Javadoc.</li>
      <li>Add a release script step to copy this javadoc to /cse/www2/types/checker-framework/jdk-api.</li>
      <li>We may also want to put jdk-api into the release directory instead of overwriting it during each release.</li>
      <li>Update this document to reflect the new steps.</li>
    </ul>
    <h3 id="fi_more_sanity_checks">More Sanity Checks</h3> <!-- omit from toc -->
    There are likely more sanity checks we might want to run during the release process.  One such example
    would be running the tutorial from the command line.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Implement one of the sanity checks mentioned in this section.</li>
      <li>Add your sanity check to the appropriate location in the release_push script.</li>
      <li>Update this document to reflect the new steps.</li>
    </ul>
    <h4 id="sanity-checks">Sanity Checks:</h4> <!-- omit from toc -->
    <ul>
      <li>Run tutorial sanity check automatically via command line.</li>
      <li>Eclipse auto-sanity check see <a href="#fi_automate_eclipse_build">Automate the Eclipse Build.</a></li>
    </ul>
    <h3 id="fi_buffalo_integeration">Buffalo Integration</h3> <!-- omit from toc -->
    If we could have Buffalo run the release_build script nightly, we could head off broken links and other
    release related errors.  There is an &quot;--auto&quot; option for this specific reason but a number of
    errors start happening when we run the script from Buffalo.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Create a Buffalo task to run the release_buld script using the &quot;--auto&quot; option.</li>
      <li>Observe the output of this task and identify possible errors.</li>
      <li>Fix up all observed errors until the release_build script runs without error.</li>
      <li>We probably want to move the link checking of the development site to the release_build script and
        write it out to disk.  This will allow the developer releasing the framework to consult pre-made
        link-checking results rather than waiting for the link checker to execute in the push script.
      </li>
    </ul>
    <h3 id="fi_auto-copy_release_scripts">Auto-copy Release Scripts</h3> <!-- omit from toc -->
    The first step in running the release process, after the pre-release checklist, is to copy the
    release scripts into the jsr308-release directory.  We could automate this.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Create a read-only script in jsr308-release/scripts.</li>
      <li>Edit the script so that it downloads all release scripts into the jsr308-release directory.</li>
      <li>Update this document to reflect this new process.</li>
    </ul>
    <h3 id="fi_option_parsing">Option Parsing</h3> <!-- omit from toc -->
    There is currently some primitive option parsing written into the release scripts.  We should use
    Python's built-in option parsing library.  There are multiple built-in libraries.  Please use the latest one.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Look up the latest Python parsing library.</li>
      <li>Replace the option parsing in the release_build.py and release_push.py scripts with library calls.</li>
    </ul>
    <h3 id="fi_option_projects">Optional Projects</h3> <!-- omit from toc -->
    A user might want to test the release_build script only on a specific project.  Some work has gone into
    the ability to select a project to build.  However, this currently doesn't take into consideration of dependencies.
    It might be more hassle than it's worth to implement this feature.  We should either complete the implementation
    or remove the partial implementation that already exists.  See <a href="#fi_repl_mode">REPL Mode</a>.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Improve option parsing to allow the user to select only certain projects to build.</li>
      <li>Improve scripts to resolve dependencies between projects and only build the selected projects and
        their dependencies.
      </li>
    </ul>
    <h3 id="fi_repl_mode">REPL Mode</h3> <!-- omit from toc -->
    The current script is built in an imperative style with little use of object orientation.  This improvement
    would create methods or objects that further encapsulate the current set of steps.  We could then provide
    an easy way to execute these steps from the Python REPL.  This would allow the user to execute individual steps
    in whatever order they saw fit from the Python REPL.  This could also be used to
    automatically back out the current release or the ability to edit/debug the release steps more easily.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Further separate the steps of the release process.</li>
      <li>Provide a default parameterization for these steps to make them easily runnable from the
        command line. </li>
      <li>Provide a script to launch Python with these commands on its path.</li>
      <li>Update this README to document the new functionality.</li>
    </ul>
  <section id="fi_automate_eclipse_build"> <!-- omit from toc -->
    <h3>Automate the Eclipse Build</h3> <!-- omit from toc -->
    The Checker Framework Eclipse plugin is the cause of the most burdensome manual steps in the release
    process.  There exist ways to automate the plugin build and tests.  However, the process is complicated and
    would take a while to perfect.  It may or may not be worth it.
    <h4>Tasks:</h4> <!-- omit from toc -->
    <ul>
      <li>Use Ant or other methods to automate the Eclipse build.</li>
      <li>Add to the release script targets for updating version numbers and other relevant fields
        of the Eclipse plugin for the release.
      </li>
      <li>Add a step(s) to build/test the Eclipse plugin from the command line to the release script.</li>
      <li>Update this README to include the new steps.</li>
    </ul>
  </section>
</div>
</div>
</div>

</body>
</html>

<!--  LocalWords:  JSR langtools serif px pre CCC JDK AFS PAG mkdir cd svn co
 -->
<!--  LocalWords:  xml ver dev yyyyMMDD URL url diff hg INV buildfile
 -->
