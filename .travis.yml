sudo: false

language: generic

services:
  - docker

env:
  - JDKVER=jdk7 GROUP=junit
  - JDKVER=jdk7 GROUP=nonjunit
  - JDKVER=jdk8 GROUP=junit
  - JDKVER=jdk8 GROUP=nonjunit
  - JDKVER=jdk7 GROUP=misc

before_script:
- docker pull mdernst/ubuntu-for-cf-$JDKVER

# Eventually, parameterize this by JDK version, branch name, etc.
script:
# - docker run ubuntu /bin/sh -c "apt-get -qqy update && apt-get -qqy upgrade && apt-get -qqy install  default-jdk  ant dia git hevea librsvg2-bin make mercurial texlive-fonts-recommended texlive-latex-base texlive-latex-extra texlive-latex-recommended unzip && export JAVA_HOME=\`which javac|xargs readlink -f|xargs dirname|xargs dirname\` && git clone --depth 3 https://github.com/mernst/checker-framework-docker-default-jdk.git checker-framework && cd checker-framework && java -version && javac -version && ./.travis-build.sh"
- docker run mdernst/ubuntu-for-cf-$JDKVER /bin/sh -c "export JAVA_HOME=\`which javac|xargs readlink -f|xargs dirname|xargs dirname\` && git clone --depth 3 https://github.com/mernst/checker-framework-docker-default-jdk.git checker-framework && cd checker-framework && java -version && javac -version && ./.travis-build.sh $GROUP"

## TODO: reinstate this.
# after_success:
#   - |
#       if [[ ($TRAVIS_BRANCH == master) &&
#             ($TRAVIS_PULL_REQUEST == false) &&
#             ( (! $TRAVIS_JOB_NUMBER == *.*) || ($TRAVIS_JOB_NUMBER == *.1) ) ]] ; then
#         curl -LO https://raw.github.com/mernst/plume-lib/master/bin/trigger-travis.sh
#         sh trigger-travis.sh typetools checker-framework-demos $TRAVISTOKEN
#         sh trigger-travis.sh typetools checker-framework-inference $TRAVISTOKEN
#         sh trigger-travis.sh typetests daikon-typecheck $TRAVISTOKEN
#         sh trigger-travis.sh typetests plume-lib-typecheck $TRAVISTOKEN
#         sh trigger-travis.sh typetools sparta $TRAVISTOKEN
#       fi

git:
  depth: 3
